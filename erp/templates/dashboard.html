<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OrderIQ â€“ Analytics</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Disable browser-level scroll */
    html, body {
      height: 100%;
      overflow: hidden;
    }

    /* Scroll container (scroll works, bar hidden) */
    .app-scroll {
      height: 100vh;
      overflow-y: auto;
      overflow-x: hidden;

      scrollbar-width: none;        /* Firefox */
      -ms-overflow-style: none;     /* IE/Edge */
    }

    .app-scroll::-webkit-scrollbar {
      display: none;                /* Chrome/Safari */
    }
  </style>
</head>

<body class="bg-[#fdca5e] font-sans">

<div class="app-scroll">

  {% include "navbar.html" %}

  <div class="max-w-[95%] mx-auto ">

    <!-- FILTER + BUTTON -->
    <div class="flex justify-end items-center gap-4 mt-4">
      <select class="border rounded-md px-3 py-2 text-sm focus:outline-none">
        <option>Today</option>
        <option>Yesterday</option>
        <option>This Week</option>
        <option>Last 7 Days</option>
      </select>

      <button
        onclick="window.location.href='{{ url_for('orders_page') }}'"
        class="bg-[#7c5327] text-white px-4 py-2 rounded-md hover:bg-black transition">
        View Orders
      </button>
    </div>

    <!-- KPI CARDS -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-5 mt-4">

      <div class="bg-white rounded-xl p-5 shadow">
        <p class="text-sm text-gray-500">Total Orders</p>
        <h2 id="totalOrders" class="text-3xl font-bold mt-2">0</h2>
      </div>

      <div class="bg-white rounded-xl p-5 shadow">
        <p class="text-sm text-gray-500">Orders Today</p>
        <h2 id="ordersToday" class="text-3xl font-bold mt-2">0</h2>
      </div>

      <div class="bg-white rounded-xl p-5 shadow">
        <p class="text-sm text-gray-500">Urgent Orders</p>
        <h2 id="urgentOrders" class="text-3xl font-bold text-red-600 mt-2">0</h2>
      </div>

      <div class="bg-white rounded-xl p-5 shadow">
        <p class="text-sm text-gray-500">Avg Confidence</p>
        <h2 id="avgConfidence" class="text-3xl font-bold text-green-600 mt-2">0%</h2>
      </div>

    </div>

    <!-- CHARTS -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-6 mb-10">

      <div class="bg-white rounded-xl p-5 shadow">
        <h3 class="font-semibold mb-3">Orders Over Time</h3>
        <div class="h-64 flex items-center justify-center text-gray-400 border rounded">
          Line Chart (Coming Next)
        </div>
      </div>

      <div class="bg-white rounded-xl p-5 shadow">
        <h3 class="font-semibold mb-3">Order Status Distribution</h3>
        <div class="h-64 flex items-center justify-center text-gray-400 border rounded">
          Pie Chart (Coming Next)
        </div>
      </div>

      <div class="bg-white rounded-xl p-5 shadow md:col-span-2">
        <h3 class="font-semibold mb-3">Priority Breakdown</h3>
        <div class="h-64 flex items-center justify-center text-gray-400 border rounded">
          Bar Chart (Coming Next)
        </div>
      </div>

    </div>
  </div>
</div>

<script>
const userIcon = document.getElementById("userIcon");
const userDropdown = document.getElementById("userDropdown");

if (userIcon && userDropdown) {
  userIcon.addEventListener("click", (e) => {
    e.stopPropagation();
    userDropdown.classList.toggle("hidden");
  });

  window.addEventListener("click", (e) => {
    if (!userIcon.contains(e.target)) {
      userDropdown.classList.add("hidden");
    }
  });
}

async function loadAnalytics() {
  const res = await fetch('/api/analytics');
  const data = await res.json();

  document.getElementById('totalOrders').innerText = data.total_orders;
  document.getElementById('ordersToday').innerText = data.orders_today;
  document.getElementById('urgentOrders').innerText = data.urgent_orders;
  document.getElementById('avgConfidence').innerText =
    data.avg_confidence + "%";
}

loadAnalytics();
</script>

</body>
</html>
